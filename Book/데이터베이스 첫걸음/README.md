# 데이터베이스 첫걸음

- 공유 자원 접근 문제(동시성 제어)

- 데이터를 어떤 포맷으로 관리할 것인가? 조회,추가,수정,삭제에 효율적인 타입으로 =>성능과도 연결  

- 데이터베이스를 다룰 때 고려할 문제들

1. 초기 비용과 운영 비용을 면밀히 고려해보고 도입해야한다.  
2. 추후 마이그레이션이 필요한지... 필요할 것 같다면 그 부분도 생각해보기.
3. 성능 최적화 => 비용 절감 효과, 사용자에게 만족스러운 경험 제공

명확한 의도를 가지고 설계된 아키텍처! - 요구사항, 가용성, 확장성, 신뢰성, 재해 대책, 성능, 보안, 비용을 고려하여 결정.   

### 안정성을 추구하기 위한 다중화 (가용성)

- 컴포넌트를 병렬화하는 클러스터링(Clustering): 예비 DB로 장애에 대비, 단일장애점 파악, Active-Active, Active-Standby

- 확장성(Scalability) 확보 

- 리플리케이션(Replication) : 데이터 동기화를 통해 DB서버와 저장소를 다중화 => 재해 분산 및 부하 분산

### 성능을 추구하기 위한 다중화

- 복수의 서버가 1개의 저장소를 공유하도록 구성되어있다면 병목이 발생할 수 있음. (Shared Disk)
- Shared Nothing 아키텍처(샤딩 Sharding) : 네트워크 이외의 자원을 모두 분리하여 아무것도 공유하지 않는 방식. DB다운에 대비하여  Covering 구성을 고려해야함. 

## DMBS의 계층
인스턴스 : DBMS 동작단위로, OS입장에서는 프로세스
데이터베이스
스키마 : 폴더에 해당. 
오브젝트 : 테이블, 인덱스 , 스토어드 프로시저 등...

MySQL : 3계층 ( 인스턴스- 스키마 - 오브젝트) 
Oracle : 4계층 (인스턴스 - 데이터베이스1개 - 스키마 - 오브젝트) 
PostgreSQL : 4계층 ( 인스턴스 - 데이터베이스 - 스키마 - 오브젝트) 

## DBMS의 트랜잭션과 동시성 제어

### 트랜잭션의 4가지 특성
1. Atomicity(원자성) : 데이터 변경을 수반하는 일련의 데이터 조작이 전부 성공할 지 실패할 지를 보증하는 구조. 모두 성공하면 COMMIT, 처리 중 오류 발생시 ROLLBACK 실행.

2. Consistency(일관성): 데이터베이스 오브젝트에 대해 각종 정합성 제약을 추가하여 일관성을 유지. 예를 들어 사용자를 식별하기 위한 임의의 일련번호를 발급할때 일련번호에 유니크 제약을 설정하면 중복된 사용자 번호를 지정할 수 없다. 

3. Isolation(고립, 격리성): 복수의 사용자가 일련의 데이터 조작을 동시에 실행해도 각각의 처리가 모순 없이 실행되는 것을 보증한다. 즉 복수의 트랜잭션이 순서대로 실행되는 것과 같은 결과를 얻는다. 병렬 실행이 일관성있게 수행되는 것이다. DB에서는 테이블 전체 혹은 행 단위로 후속처리에 대해 락을 걸어서 블록시키는 방법이 있다. 

격리 수준(Transaction Isolation Level) : 4번의 Serializable이 가장 엄격한 수준의 격리수준이다. 격리 수준이 완화되면서 Pantom Read, Fuzzy Read, Dirty Read와 같은 현상이 발생한다. 

	4. Serializable : 안전하지만 성능면에서는 실용적이지 않을 수 있다. 
	3. Repeatable Read - Pantom Read 현상 발생 : 어떤 트랜잭션을 읽을 때 선택할 수 있는 데이터가 나타나거나 사라지는  현상(다른 사용자가 INSERT, DELETE하여 조회를 반복할시 결과가 달라짐) 
	2. Read Committed - 추가로 Fuzzy Read 현상 발생 : 어떤 트랜잭션이 이전에 읽어 들인 데이터를 다시 읽어 들일 때 2회 이후의 결과가 1회 때와 다른 현상.  
	1. Read Uncommitted - 추가로 Dirty Read 현상 발생: 어떤 트랜잭션이 커밋되기도 전에 다른 트랜잭션에서 데이터를 읽는 현상.

4. Durability(지속성) : 트랜잭션 조작을 COMMIT하고 완료 통지를 사용자가 받는 시점에서 그 조작이 영구적이 되어 그 결과를 잃지않는다.  시스템이 비정상일 때도 충족해야함. 트랜잭션 조작을 하드 디스크에 로그로 기록하고 시스템에 이상이 발생하면 그 로그를 사용해 이상 발생 전의 상태까지 복원하는 것으로 지속성을 실현하고 있음. 