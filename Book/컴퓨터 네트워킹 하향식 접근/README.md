# 컴퓨터 네트워킹 하향식 접근

## 1. 인터넷과 프로토콜

-   인터넷이란?
    -   정의: 네트워크의 연결
    -   구성요소
        -   하드웨어
            -   host(end system): 클라이언트와 서버로 구분할 수 있다.
            -   links  
                -   구리선, 동축 케이블, 광케이블, 라디오 스펙트럼, 위성 전파
                -   전송률(링크 대역폭) (transmission rate, link capacity, bandwith) - 단위 bit per second (bps)
                -   end system 과 router 간 링크를 통해 데이터를 교환한다.
            -   router, switch
                -   라우터와 스위치는 도착하는 패킷을 받아서 출력 통신 링크로 패킷을 전달한다.
        -   소프트웨어
            -   운영체제
            -   응용 프로그램
            -   프로토콜
                -   프로토콜은 둘 이상의 통신 개체 간에 교환되는 메시지 포맷과 순서뿐만 아니라, 메시지의 송수신과 다른 이벤트에 따른 행동을 정의한다.
                -   TCP/IP 는 인터넷에서 가장 중요한 프로토콜이다.
-   네트워크 엣지
    -   접속 네트워크(access network): end system 간에 연결되는 경로상의 첫번째 라우터에 연결하는 네트워크
        -   DSL, 케이블, FTTH, 5G-FW
        -   이더넷(Ethernet) 스위치
        -   무선 LAN(Wi-Fi) - AP(access point)
        -   3G / 4G LTE / 5G
    -   비트의 전달 방식
        -   출발지 host(end system)이 비트를 전송한다.
        -   첫번째 라우터가 비트를 수신한 후에 경로 상의 다음 라우터로 전송하고 두번째 라우터가 비트를 수신한다.
        -   비트는 물리 매체(꼬임쌍선, 동축케이블, 광케이블, 지상파, 위성파) 상에서 전자파나 광 펄스를 전파하여 전송한다.
-   네트워크 코어
    -   네트워크 코어는 인터넷의 end system 을 연결하는 패킷 스위치(라우터)와 링크의 그물망 형태를 가지고 있다.
    -   패킷 교환
        -   host(end system) 간의 통신시 긴 메시지를 패킷(paket)이라는 작은 데이터 단위로 분할하여 전송된다.
        -   각 패킷은 패킷 스위치(라우터)와 링크계층 스위치를 거치게된다.
        -   라우터는 저장 후 전달 전송 방식을 이용한다. 패킷을 전달시 전체 패킷을 수신할 때까지 버퍼에 패킷의 비트를 저장한 후 전체 패킷의 비트를 수신하면 완성된 패킷을 다음 라우터로 전송한다.
    -   큐잉 지연과 패킷 손실
        -   라우터는 링크에 대해 출력 버퍼를 가지고 있으며 그 링크로 송신하려는 패킷을 저장하고 있다.
        -   도착하는 패킷이 전송되어야 하는 링크가 다른 패킷을 전송하고 있다면 도착하는 패킷이 출력 버퍼에서 대기해야하는 큐잉 지연(Queuing delay) 현상이 발생한다.
        -   버퍼 공간의 크기가 유한하므로 버퍼 공간이 꽉 차있다면 패킷 손실이 발생할 수도 있다.
    -   포워딩 테이블과 라우팅 프로토콜
        -   라우터는 패킷을 어느 링크로 전달할 지 어떻게 결정하는가?
            -   모든 host(end system)은 고유의 IP 주소를 가진다.
            -   패킷을 전송할 때 패킷의 헤더에 목적지의 IP 주소를 포함하여 전송한다.
            -   각 라우터는 목적지 주소를 라우터의 출력 링크로 매핑하는 포워딩 테이블을 갖고 있다.
            -   라우터는 도착한 패킷을 조사하여 IP 주소를 확인 후 IP 주소를 이용하여 포워딩 테이블을 검색한다.
            -   확인된 출력 링크로 도착한 패킷을 전송한다.
        -   포워딩 테이블은 어떻게 설정되는가?
            -   인터넷은 자동으로 포워딩 테이블을 설정하는 데 이용되는 라우팅 프로토콜을 가지고 있다.
    -   데이터 전달 방식
        -   회선 교환 방식(circuit switching)
        -   패킷 교환 방식(packet switching)

- 프로토콜 계층
    -   프로토콜은 계층 구조를 이루고 있다.
    -   각 계층은 인접 계층과 연계하여 특정한 서비스를 구현한다.
    -   각 계층에서 패킷은 헤더 필드와 페이로드 필드라는 두 가지 형태의 필드를 가지고 있으며 페이로드는 일반적으로 상위 계층의 패킷을 의미한다.
    -   상위 계층에서 하위 계층으로 메시지 이동시 캡슐화 과정을 거친다.
 
 - 애플리케이션 계층

	-   네트워크 애플리케이션, 애플리케이션 계층 프로토콜(HTTP, SMTP, FTP 등)이 존재하는 계층
	-   애플리케이션 계층 프로토콜을 통해 다른 end system의 애플리케이션과 정보 패킷(message)을 교환할 수 있다.

- 트랜스포트 계층

	-   클라이언트와 서버 간에 애플리케이션 계층 메시지를 전송하는 서비스를 제공한다.
	-   트랜스포트 계층 패킷을 segment라고 부른다.
	-   TCP
	    -   연결 지향형 서비스 제공
	    -   연결 지향형 서비스는 애플리케이션 계층 메시지 전달을 보장하고 흐름 제어 기능을 포함한다.
	    -   긴 메시지를 짧은 메시지로 나누고 혼잡 제어 기능을 제공하여 네트워크가 혼잡할 때 출발지의 전송률을 조정한다.
	-   UDP
	    -   비연결형 서비스 제공
	    -   비연결형 서비스는 전달보장, 흐름제어, 혼잡 제어 기능 없이 단순히 애플리케이션 계층의 메시지를 전송만 하는 간단한 서비스다.

- 네트워크 계층(IP 계층)

	-   네트워크 계층 패킷을 datagram이라고 부른다.
	-   네트워크 계층은 호스트 간 datagram을 라우팅 하는 책임 갖고 있다.
	    -   출발지 end system(호스트)에서 트랜스포트 계층 프로토콜은 트랜스 포트 계층 세그먼트와 목적지 주소를 네트워크 계층으로 전달한다.
	    -   네트워크 계층은 이렇게 전달받은 목적지 주소를 이용하여 목적지 end system 의 트랜스포트 계층으로 세그먼트를 운반한다.
	-   네트워크 계층 프로토콜은 IP 프로토콜과 라우팅 프로토콜을 포함한다.
	-   IP
	    -   네트워크 계층을 가진 모든 인터넷 요소는 IP 프로토콜을 수행해야한다.
	-   라우팅 프로토콜
	    -   출발지와 목적지 사이에서 데이터그램이 이동하는 경로를 결정한다.

- 링크 계층

	-   경로 상의 한 노드에서 다른 노드로 패킷을 이동하기 위해 네트워크 계층은 링크 계층 서비스에 의존하고 있다.
	-   각 노드에서 네트워크 계층은 데이터그램을 아래 링크 계층으로 보내고 링크 계층은 전달 받은 데이터그램을 경로상의 다음 노드에 전달한다. 다음 노드에서 링크 계층은 데이터그램을 상위 네트워크 계층으로 보낸다.
	-   링크 계층 패킷은 프레임(frame)이라고 부른다.

- 물리 계층
	-   링크 계층의 패킷(frame) 내부의 각 비트를 이동하는 책임을 수행한다.


## 2. 애플리케이션 계층

#### 네트워크 애플리케이션의 원리
	서로 다른 위치의 end system 에서 동작하고 네트워크를 통해 서로 통신하는 프로그램을 네트워크 애플리케이션이라고 한다.
	end system에만 애플리케이션 소프트웨어가 존재한다.
	네트워크 코어 장비에서 실행되는 소프트웨어까지 작성할 필요가 없고 작성할 수도 없다. 
	각 계층은 각기 맡은 책임만을 수행한다. 계층별로 나누어 관리하고 발전하고 개발할 수 있다.
- 네트워크 애플리케이션의 구조
	- 클라이언트 - 서버
	- P2P(peer to peer)
- 프로세스간 통신
	- 개요
		- 실제로 통신하는 것은 프로그램이 아니라 프로세스다.
		- 프로세스는 컴퓨터 네트워크를 통한 메시지 교환 (요청-응답)을 통해 서로 통신한다.
		- 프로세스 간의 통신을 위한 규칙은 end system의 운영체제에 의존한다.
	- 클라이언트와 서버 프로세스
		- 클라이언트 프로세스
			- 프로세스 간의 통신 세션에서 다른 프로세스와 세션을 시작하려고 접속을 초기화(통신초기화)하는 프로세스를 의미한다.
		- 서버 프로세스
			- 세션을 시작하기 위해 접속을 기다리는 프로세스를 의미한다.
	- 프로세스와 컴퓨터 네트워크 사이의 인터페이스
		- 프로세스는 소켓(socket)을 통해 네트워크로 메시지를 보내고 받는다.
		- 소켓은 애플리케이션 계층과 트랜스포트 계층간의 인터페이스다.
		- 소켓은 애플리케이션과 네트워크 사이의 API 라고도 한다.
		- 개발자는 소켓의 애플리케이션 계층에 대한 모든 통제권을 갖고 활용할 수 있지만 소켓의 트랜스포트 계층은 거의 통제할 수 없다. 트랜스포트 프로토콜의 선택과 최대 버퍼와 최대 세그먼트 크기 같은 매개변수 설정 밖에 할 수 없다.
	- 통신 대상 프로세스는 IP 주소와 포트번호로 식별할 수 있다.
	- 트랜스포트 계층 포로토콜은 수신 프로세스의 소켓으로 네트워크를 통해 메시지를 이동시킬 책임이 있다.
	- 트랜스포트 계층 프로토콜이 제공하는 서비스
		- 신뢰적 데이터 전송(reliable data transfer)
			- 트랜스포트 계층 프로토콜은 신뢰적 데이터 전송 서비스를 제공할 수 있다. 
			- 패킷이 손실되면 host 혹은 router에 의해 패킷이 버려질 수 있다.
			- 패킷이 손실되면 큰일나는 애플리케이션이 존재한다. 이 경우 데이터가 오류 없이 수신 프로세스에 도착할 것이라는 확신을 제공하는 기능이 필요하다. 은행 같은 경우 이러한 기능은 무조건 필요하다.
			- 신뢰적 데이터 전송 서비스는 프로토콜이 데이터 전송을 안전하게 보장하는 기능이다.
			- 반면 이러한 서비스가 필요하지 않은 애플리케이션은 약간의 데이터 손실을 감수할 수 있다.
				- 오디오나 비디오의 품질 저하
		- 처리율
			- 트랜스포트 계층 프로토콜은 처리율 보장을 제공할 수 있다. 
			- 처리율은 네트워크 경로를 따라 두 프로세스간의 통신 세션에서 송신 프로세스가 수신 프로세스로 비트를 전달할 수 있는 비율을 의미한다. 
			- 애플리케이션이 최소로 필요로 하는 처리율을 트랜스포트 프로토콜이 보장할 수 있어야하는 경우가 있다. 처리율 요구사항을 갖는 애플리케이션을 대역폭 민감 애플리케이션이라고 한다. 
				- 예) 인터넷전화
			- 반면 이러한 최소한의 처리율을 보장할 필요가 없는 애플리케이션을 탄력적 애플리케이션(elastic application) 이라고 한다. 
				- 예) 메일, 파일 전송
		- 시간
			- 트랜스포트 계층 프로토콜은 시간 보장을 제공할 수 있다. 
			- 송신자가 소켓으로 내보내는 모든 비트가 수신자의 소켓에 특정 시간내에 도착해야만 하는 애플리케이션
				- 예) 인터넷 전화, 가상환경, 원격 화상 회의, 등 실시간 상호작용 애플리케이션
		- 보안
			- 트랜스포트 계층 프로토콜은 애플리케이션에 하나 이상의 보안 서비스를 제공할 수 있다.
				- 트랜스포트 프로토콜은 송신 호스트의 송신 프로세스가 전송하는 모든 데이터를 암호화할 수 있고 수신 호스트에서 그 데이터를 수신프로세스로 전달하기 전에 데이터의 암호를 해독할 수 있다.
			- 데이터 무결성 서비스를 제공한다. 
			- 종단 인증 서비스를 제공한다. 
- 인터넷 전송 프로토콜이 제공하는 서비스 비교
    -   TCP 와 UDP는 애플리케이션에 서로 다른 서비스를 제공한다.
    -   애플리케이션의 요구사항을 살펴보고 결정해야한다.
        -   데이터 손실
        -   대역폭
        -   시간 민감성
    -   TCP
        -   연결지향형 서비스
            -   애플리케이션 계층 메시지를 전송하기전 클라이언트와 서버가 서로 전송 제어 정보를 교환한다(핸드쉐이킹)
            -   이렇게 TCP 연결이 두 프로세스의 소켓사이에 존재하게 되고 그때부터 서로 통신을 시작한다.
            -   수신 프로세스가 받을 수 있는 용량의 데이터만 보낼 수 있다.
        -   신뢰적인 데이터 전송 서비스
            -   TCP는 패킷 손실 없이 수신 소켓으로 데이터를 전송할 수 있게 보장한다.
            -   모든 데이터를 오류 없이 올바른 순서로 전달한다.
            -   에러가 발생할 경우 재전송을 요청한 후 에러가 없는 데이터가 모두 도착했을 때 애플리케이션 레이어에 전달한다.
            -   HTTP, SMTP, FTP는 데이터 손실이 발생하면 안되기 때문에 TCP를 사용한다.
        -   혼잡 제어 서비스
            -   네트워크가 혼잡 상태에 이르면 프로세스 속도를 낮추어서 각 TCP 연결이 네트워크 대역폭을 공평하게 공유할 수 있게끔 한다.
    -   UDP
        -   비신뢰적인 서비스
            -   비연결형이므로 두 프로세스가 통신을 하기전에 핸드셰이킹 하지 않는다.
            -   그래서 전반적으로 TCP보다 속도가 빠르다.
            -   순서가 뒤바뀔수도 있고 데이터 손실이 발생할 수도 있다.
        -   송신 측은 데이터를 원하는 속도로 보낼 수 있지만 실제로 제한된 대역폭, 혼잡으로 인해 전송 속도가 감소할 수 있다.
-   WEB과 HTTP
    -   URL
        -   웹 페이지의 객체는 URL로 지정할 수있는 하나의 파일이다.
    -   HTTP(HyperText Transfer Protocol)
        -   HTTP는 메시지의 구조 및 클라이언트와 서버가 메시지를 어떻게 교환하는지에 대해 정의한다.
        -   데이터 손실이 일어나면 안되기 때문에 TCP를 전송 프로토콜로 사용한다.
        -   비상태 프로토콜(stateless)
            -   서버가 클라이언트에게 요청파일을 보낼때 서버는 클라이언트에 관한 어떠한 상태정보도 저장하지 않는다.
        -   기본적으로 지속 연결 모드로 사용하지만 비지속 연결 모드를 사용할 수 도 있음.
            -   지속 연결: 모든 요청과 응답이 같은 TCP 연결을 통해 이루어 진다.(persistent)
            -   비지속 연결: 각 요청와 응답이 분리된 TCP 연결을 통해 이루어진다.(non-persistent)
        -   HTTP 메시지 구조
            -   ASCII 텍스트로 쓰여있음.
            -   요청 메시지
                -   request line
                    -   method 필드: GET, POST, PUT, DELETE, HEAD...
                    -   url 필드
                    -   HTTP 버전 필드
                -   header line
                    -   헤더 필드 이름: 값 + CR + LF
                -   entity body
            -   응답 메시지
                -   status line
                    -   HTTP 버전 필드
                    -   상태 코드 필드
                    -   해당 상태 코드 메시지 필드
                -   header line
                    -   헤더 필드 이름: 값 + CR + LF
                -   entity body
        -   HTTP 개발 역사
            -   HTTP/1
                -   1996년
                -   비지속 연결
            -   HTTP/1.1
                -   1999년
                -   동기적 지속 연결
            -   HTTP/2.0
                -   2015년
                -   비동기적 지속 연결
    -   쿠키
        -   무상태 프로토콜인 HTTP를 사용하지만 사용자의 접속을 제어하거나 사용자에 따라 다른 콘텐츠를 제공해야할 필요성 때문에 개발되었다.
        -   서버에는 사용자의 state 를 쿠키로 저장한다.
    -   웹 캐시
        -   수 많은 사람들이 같은 사이트에 접속하는 경우 오버헤드가 커진다. 즉 부하가 생기고 속도가 느려진다.
        -   똑같은 중복 요청의 경우 origin 서버까지 요청이 가지 않아도 동일한 결과를 응답할 수 있다. origin 서버로부터 이전에 미리 받아서 저장하고 있던 데이터로 중간의 프록시 서버가 응답한다.
        -   CDN 회사는 웹 캐시를 설치하여 많은 트래픽을 분산하고 있다.
        -   그렇다면 복사본이 최신 버전이라는 것을 어떻게 보장할 것인가?
            -   HTTP 는 클라이언트가 브라우저로 전달되는 모든 객체가 최신의 것임을 확인하면서 캐싱을 하게 해주는 방식을 갖고 있다. 이 방식을 조건부 GET 이라고 한다.
            -   GET 방식과 if-modified-since 헤더를 사용한다.
-   SSL / TLS
    -   TCP 데이터 전송시 암호화를 제공하는 프로토콜
    -   Secured Socket Layer / Transpost Layer Security
    -   애플리케이션 계층 프로토콜
    -   서버와 통신 시작 시 TCP의 핸드셰이킹처럼 SSL 연결을 먼저 확립하고 암호화된 방식으로 통신할 수 있게 한다.
    -   http => +SSL/TLS => https
-   인터넷 전자메일
    -   구성요소
        -   user agent
            -   사용자가 메시지를 읽고 응답하고 전달하고 저장하고 구성하게 해준다.
            -   예) gmail, apple mail, naver mail...
        -   mail server
            -   메일 서버 내에는 mail box가 존재한다.
            -   mail box는 메일을 유지하고 관리한다.
        -   SMTP(Simple Mail Transfer Protocol)
            -   인터넷 전자 메일을 위한 애플리케이션 계층 프로토콜
            -   TCP 이용
-   DNS
    -   IP 버전 4 주소의 경우 32 bit 길이의 주소를 가지는데 사람이 읽고 기억하기가 어렵다.
    -   사용자가 www.google.com 이라고 주소를 입력하면 해당하는 IP 주소를 알려주는게 DNS 시스템이다.
    -   데이터센터에서 여러 대의 서버를 두는 경우 호스트 이름은 동일하더라도 IP 주소를 다르게 관리할 수 있어 트래픽을 분산할 수 있는 장점도 있다.
    -   DNS 시스템은 지역적으로도 분산되어 있고 계층적으로 역할이 나누어져있다.
    -   Root - Top Level - authoritative



## 3. 트랜스포트 계층

-   트랜스포트 계층이 제공하는 서비스
    -   트랜스포트 계층 프로토콜은 각기 다른 호스트에서 동작하는 애플리케이션의 프로세스 간의 논리적인 통신을 제공한다.
        -   현재 실행되고 있는 다수의 프로세스를 구별하여 통신할 수 있다.  
            
        -   end system 사이의 IP 전달 서비스를 end system 에서 동작하는 두 프로세스 간의 전달 서비스로 확장한다.
            -   트랜스포트 계층은 세그먼트를 검사하여 올바른 목적지의 프로세스의 소켓에게 전달한다. 호스트의 각 소켓은 포트번호도 할당받는다.  
                
            -   호스트 사이의 전달을 프로세스 사이의 전달로 확장하는 것을 트랜스포트 계층 다중화(Transport-layer multiplexing) 또는 역다중화(demultiplexing)라고 부른다.  
                -   트랜스포트 계층 세그먼트의 데이터를 올바른 소켓으로 전달하는 작업을 역다중화라고 한다.
                -   출발지 호스트에서 소켓으로부터 데이터를 모으고 이에 대한 세그먼트를 생성하기 위해 각 데이터에 헤더 정보로 캡슐화하고 그 세그먼트들을 네트워크 계층으로 전달하는 작업을 다중화라고 한다.
            -   소켓은 유일한 식별자를 가지고 있으며, 각 세그먼트는 세그먼트가 전달될 적절한 소켓을 가리키는 특별한 필드를 갖고 있다. 그 필드는 출발지 포트 번호 필드와 목적지 포트 번호 필드이다. 각각의 포트 번호는 0~ 65535까지의 16비트 정수다.  
                
        -   TCP와 UDP는 헤더에 오류 검출 필드를 추가함으로써 무결성 검사를 수행할 수 있다.
    -   통신 방법
        -   송신: 송신 측의 트랜스포트 계층은 송신 애플리케이션 프로세스로부터 수신한 메시지를 세그먼트(segment)로 변환하고 트랜스포트 계층 헤더를 추가한다. 그 후 네트워크 계층으로 세그먼트를 전달한다. 네트워크 계층은 호스트 사이의 논리적 통신을 제공한다고 할 수 있다.
        -   수신: 수신 측의 트랜스포트 계층은 네트워크 계층으로부터 전달받은 세그먼트를 데이터로 이용할 수 있게 만든다.
    -   네트워크 계층의 IP 프로토콜이 패킷을 분실하거나 손상시켜도 애플리케이션에게 신뢰적인 데이터 전송 서비스를 제공할 수 있다. 또 네트워크 계층이 트랜스포트 계층 세그먼트의 기밀성을 보장할 수 없을 때도 메시지를 암호화 할 수 있다.  
        
-   UDP(User Datagram Protocol)
    -   비신뢰적이고 비연결형인 서비스 제공
        -   각각의 세그먼트는 독립적으로 취급이 된다.
        -   TCP에 비해 상대적으로 속도가 빠르다.
        -   다중화와 역다중화 기능과 간단한 오류 검사 기능만을 제공한다.
        -   UDP를 사용하려면서 신뢰적인 데이터를 전송하려면 애플리케이션 자체에서 확인응답 기능과 재전송 기능을 제공해야한다. 이런 방식의 장점은 TCP의 혼잡 제어 메커니즘에 의해 전송률 억제를 강요당하지 않고도 신뢰적으로 통신할 수 있다.
    -   UDP 다중화와 역다중화
        -   UDP 소켓은 목적지 IP 주소와 목적지 포트 번호로 구성된 두 요소의 집합으로 구별된다.  
            
    -   UDP 세그먼트 구조
        -   UDP 헤더는 2바이트씩으로 구성된 4개의 필드를 가진다. (4byte, 32bit)  
            -   출발지 포트 번호, 목적지 포트번호, 길이, 체크섬
            -   체크섬은 세그먼트에 오류가 발생했는지를 검사하기위해 수신 호스트가 사용한다.  
                
-   TCP
    -   신뢰적이고 연결지향형 서비스 제공
    -   신뢰적인 데이터 전송: 데이터가 순서대로 정확하게 전달되도록 보장
        -   흐름제어
        -   순서번호
        -   확인응답
        -   타이머
    -   혼잡 제어
    -   TCP 다중화와 역다중화
        -   TCP 소켓은 출발지 IP주소, 출발지 포트번호, 목적지 IP주소, 목적지 포트번호로 구성된 4가지 요소의 집합으로 구별된다.
        -   서버는 각기 다른 클라이언트가 보낸 세그먼트를 출발지 IP주소와 출발지 포트 번호로 구별한다.


## 4. 네트워크 계층

네트워크 계층의 책임

-   네트워크 계층은 호스트 사이의 통신 서비스를 제공한다.
-   호스트는 IP 주소로 구별할 수 있다.
-   IP 프로토콜은 트랜스포트 계층의 segement 를 전달받아 IP 헤더를 붙여서 datagram(IP 계층의 패킷을 지칭)을 만들고 데이터 링크 계층으로 전달한다.